<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECO Tracker - Admin Panel</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="database.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f9ff 25%, #fff7ed 50%, #f3e8ff 75%, #ecfdf5 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #1f2937;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
            background-size: cover;
            background-position: center;
            filter: blur(8px);
            opacity: 0.05;
            z-index: -1;
        }

        .admin-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
            gap: 0;
        }

        /* Sidebar */
        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(46, 125, 50, 0.1);
            padding: 20px 0;
            position: relative;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
        }

        .sidebar-header {
            padding: 0 20px 30px;
            border-bottom: 1px solid rgba(46, 125, 50, 0.1);
            margin-bottom: 30px;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 700;
            color: #16a34a;
            margin-bottom: 10px;
        }

        .admin-badge {
            background: linear-gradient(135deg, #ef4444, #f97316);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-menu {
            list-style: none;
            padding: 0 15px;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: #64748b;
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(46, 125, 50, 0.1);
            color: #16a34a;
        }

        .nav-icon {
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            padding: 30px;
            overflow-y: auto;
        }

        .content-header {
            margin-bottom: 40px;
        }

        .content-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 10px;
        }

        .content-subtitle {
            color: #64748b;
            font-size: 1.1rem;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(46, 125, 50, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .stat-title {
            font-size: 1rem;
            font-weight: 600;
            color: #64748b;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .stat-icon.blue {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
        }

        .stat-icon.green {
            background: linear-gradient(135deg, #16a34a, #22c55e);
        }

        .stat-icon.purple {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
        }

        .stat-icon.orange {
            background: linear-gradient(135deg, #f59e0b, #f97316);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 5px;
        }

        .stat-description {
            color: #64748b;
            font-size: 14px;
        }

        /* Content Sections */
        .content-section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid rgba(46, 125, 50, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .data-table th {
            background: rgba(46, 125, 50, 0.05);
            font-weight: 600;
            color: #374151;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .data-table tr:hover {
            background: rgba(46, 125, 50, 0.02);
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
        }

        .status-trial {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }

        .status-expired {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .status-basic {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
        }

        .status-pro {
            background: rgba(139, 92, 246, 0.1);
            color: #7c3aed;
        }

        .status-premium {
            background: rgba(236, 72, 153, 0.1);
            color: #db2777;
        }

        .action-btn {
            background: none;
            border: 1px solid #e5e7eb;
            color: #64748b;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            margin-right: 5px;
        }

        .action-btn:hover {
            background: rgba(46, 125, 50, 0.05);
            border-color: #16a34a;
            color: #16a34a;
        }

        .action-btn.danger:hover {
            background: rgba(239, 68, 68, 0.05);
            border-color: #ef4444;
            color: #ef4444;
        }

        /* Search and Filters */
        .table-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #16a34a;
            box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
        }

        .filter-select {
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            font-size: 14px;
        }

        .filter-select:focus {
            outline: none;
            border-color: #16a34a;
        }

        /* Charts Placeholder */
        .chart-container {
            height: 300px;
            background: rgba(46, 125, 50, 0.02);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            font-style: italic;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .admin-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: fixed;
                top: 0;
                left: -280px;
                width: 280px;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .mobile-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 30px;
                padding: 15px 0;
            }
            
            .menu-toggle {
                background: none;
                border: none;
                font-size: 1.5rem;
                color: #16a34a;
                cursor: pointer;
            }
        }

        @media (min-width: 1025px) {
            .mobile-header {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <span>🌱</span>
                    <span>ECO Tracker</span>
                </div>
                <div class="admin-badge">Admin Panel</div>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-section="overview">
                        <span class="nav-icon"><i class="fas fa-tachometer-alt"></i></span>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="users">
                        <span class="nav-icon"><i class="fas fa-users"></i></span>
                        Users
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="subscriptions">
                        <span class="nav-icon"><i class="fas fa-crown"></i></span>
                        Subscriptions
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="analytics">
                        <span class="nav-icon"><i class="fas fa-chart-bar"></i></span>
                        Analytics
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="settings">
                        <span class="nav-icon"><i class="fas fa-cog"></i></span>
                        Settings
                    </a>
                </li>
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-link">
                        <span class="nav-icon"><i class="fas fa-arrow-left"></i></span>
                        Back to App
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="mobile-header">
                <button class="menu-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>Admin Panel</h1>
            </div>

            <!-- Overview Section -->
            <div class="content-section active" id="overview">
                <div class="content-header">
                    <h1 class="content-title">Admin Dashboard</h1>
                    <p class="content-subtitle">Monitor and manage your ECO Tracker platform</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Total Users</div>
                            <div class="stat-icon blue">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalUsers">-</div>
                        <div class="stat-description">Registered users</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Active Subscriptions</div>
                            <div class="stat-icon green">
                                <i class="fas fa-crown"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="activeSubscriptions">-</div>
                        <div class="stat-description">Paying customers</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Total Scans</div>
                            <div class="stat-icon purple">
                                <i class="fas fa-camera"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalScans">-</div>
                        <div class="stat-description">Platform-wide</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Food Waste Tracked</div>
                            <div class="stat-icon orange">
                                <i class="fas fa-recycle"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalFoodWaste">-</div>
                        <div class="stat-description">kg processed</div>
                    </div>
                </div>

                <div class="section-card">
                    <h2 class="section-title">Recent Activity</h2>
                    <div class="chart-container">
                        <div>
                            <i class="fas fa-chart-line" style="font-size: 3rem; margin-bottom: 20px; display: block;"></i>
                            Activity charts and recent user actions would be displayed here
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Section -->
            <div class="content-section" id="users">
                <div class="content-header">
                    <h1 class="content-title">User Management</h1>
                    <p class="content-subtitle">Manage registered users and their accounts</p>
                </div>

                <div class="section-card">
                    <h2 class="section-title">All Users</h2>
                    
                    <div class="table-controls">
                        <div class="search-box">
                            <input type="text" class="search-input" id="userSearch" placeholder="Search users...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        <select class="filter-select" id="userStatusFilter">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                        <select class="filter-select" id="userPlanFilter">
                            <option value="">All Plans</option>
                            <option value="trial">Trial</option>
                            <option value="basic">Basic</option>
                            <option value="pro">Pro</option>
                            <option value="premium">Premium</option>
                        </select>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Email</th>
                                <th>Plan</th>
                                <th>Status</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Subscriptions Section -->
            <div class="content-section" id="subscriptions">
                <div class="content-header">
                    <h1 class="content-title">Subscription Management</h1>
                    <p class="content-subtitle">Monitor and manage user subscriptions</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Trial Users</div>
                            <div class="stat-icon orange">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="trialCount">-</div>
                        <div class="stat-description">On trial period</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Basic Plans</div>
                            <div class="stat-icon blue">
                                <i class="fas fa-star"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="basicCount">-</div>
                        <div class="stat-description">Basic subscribers</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Pro Plans</div>
                            <div class="stat-icon purple">
                                <i class="fas fa-star-half-alt"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="proCount">-</div>
                        <div class="stat-description">Pro subscribers</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Premium Plans</div>
                            <div class="stat-icon green">
                                <i class="fas fa-crown"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="premiumCount">-</div>
                        <div class="stat-description">Premium subscribers</div>
                    </div>
                </div>

                <div class="section-card">
                    <h2 class="section-title">All Subscriptions</h2>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Plan</th>
                                <th>Status</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Auto Renew</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="subscriptionsTableBody">
                            <!-- Subscriptions will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics Section -->
            <div class="content-section" id="analytics">
                <div class="content-header">
                    <h1 class="content-title">Platform Analytics</h1>
                    <p class="content-subtitle">Detailed insights and usage statistics</p>
                </div>

                <div class="section-card">
                    <h2 class="section-title">Usage Metrics</h2>
                    <div class="chart-container">
                        <div>
                            <i class="fas fa-chart-area" style="font-size: 3rem; margin-bottom: 20px; display: block;"></i>
                            Usage trends, scan volumes, and user engagement charts would be displayed here
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <h2 class="section-title">Revenue Analytics</h2>
                    <div class="chart-container">
                        <div>
                            <i class="fas fa-rupee-sign" style="font-size: 3rem; margin-bottom: 20px; display: block;"></i>
                            Revenue tracking, subscription conversion rates, and financial metrics
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="content-section" id="settings">
                <div class="content-header">
                    <h1 class="content-title">System Settings</h1>
                    <p class="content-subtitle">Configure platform settings and preferences</p>
                </div>

                <div class="section-card">
                    <h2 class="section-title">Database Management</h2>
                    <p style="color: #64748b; margin-bottom: 20px;">
                        Manage the system database and user data (Development tools)
                    </p>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="action-btn" onclick="exportAllData()">
                            <i class="fas fa-download"></i> Export All Data
                        </button>
                        <button class="action-btn danger" onclick="resetDatabase()">
                            <i class="fas fa-trash"></i> Reset Database
                        </button>
                    </div>
                </div>

                <div class="section-card">
                    <h2 class="section-title">System Information</h2>
                    <div style="color: #64748b;">
                        <p><strong>Database Type:</strong> LocalStorage (Development Mode)</p>
                        <p><strong>Version:</strong> 1.0.0</p>
                        <p><strong>Last Updated:</strong> <span id="lastUpdated">-</span></p>
                        <p><strong>Total Storage Used:</strong> <span id="storageUsed">-</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize admin panel
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user has admin access
            if (!isAdmin()) {
                // Redirect to admin login page
                window.location.href = 'admin-login.html';
                return;
            }

            loadDashboardData();
            loadUsersTable();
            loadSubscriptionsTable();
        });

        function isAdmin() {
            // Check for proper admin authentication
            const user = JSON.parse(localStorage.getItem('ecoTracker_user') || '{}');
            return user.isAdmin === true && user.authMethod === 'admin_panel';
        }

        function loadDashboardData() {
            const analytics = ecoTrackerDB.getAnalytics();
            
            document.getElementById('totalUsers').textContent = analytics.totalUsers;
            document.getElementById('activeSubscriptions').textContent = 
                analytics.subscriptionBreakdown.basic + 
                analytics.subscriptionBreakdown.pro + 
                analytics.subscriptionBreakdown.premium;
            document.getElementById('totalScans').textContent = analytics.totalScans.toLocaleString();
            document.getElementById('totalFoodWaste').textContent = analytics.totalFoodWaste.toFixed(1);

            // Update subscription breakdown
            document.getElementById('trialCount').textContent = analytics.subscriptionBreakdown.trial;
            document.getElementById('basicCount').textContent = analytics.subscriptionBreakdown.basic;
            document.getElementById('proCount').textContent = analytics.subscriptionBreakdown.pro;
            document.getElementById('premiumCount').textContent = analytics.subscriptionBreakdown.premium;

            // System info
            document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
            updateStorageInfo();
        }

        function loadUsersTable() {
            const users = ecoTrackerDB.getAllUsers();
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const subscription = ecoTrackerDB.getSubscription(user.id);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #16a34a, #22c55e); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 12px;">
                                ${user.name ? user.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2) : 'U'}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${user.name || 'Unknown'}</div>
                                <div style="font-size: 12px; color: #64748b;">${user.authMethod || 'email'}</div>
                            </div>
                        </div>
                    </td>
                    <td>${user.email || user.phone || '-'}</td>
                    <td><span class="status-badge status-${subscription?.plan || 'trial'}">${subscription?.plan || 'trial'}</span></td>
                    <td><span class="status-badge ${user.isActive ? 'status-active' : 'status-expired'}">${user.isActive ? 'Active' : 'Inactive'}</span></td>
                    <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                    <td>
                        <button class="action-btn" onclick="viewUser('${user.id}')">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="action-btn" onclick="editUser('${user.id}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="action-btn danger" onclick="deleteUser('${user.id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadSubscriptionsTable() {
            const subscriptions = ecoTrackerDB.getAllSubscriptions();
            const tbody = document.getElementById('subscriptionsTableBody');
            tbody.innerHTML = '';

            subscriptions.forEach(sub => {
                const user = ecoTrackerDB.getUser(sub.userId);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user?.name || 'Unknown User'}</td>
                    <td><span class="status-badge status-${sub.plan}">${sub.plan}</span></td>
                    <td><span class="status-badge ${sub.status === 'active' ? 'status-active' : 'status-expired'}">${sub.status}</span></td>
                    <td>${new Date(sub.startDate).toLocaleDateString()}</td>
                    <td>${new Date(sub.endDate).toLocaleDateString()}</td>
                    <td>${sub.autoRenew ? 'Yes' : 'No'}</td>
                    <td>
                        <button class="action-btn" onclick="changePlan('${sub.userId}')">
                            <i class="fas fa-edit"></i> Change Plan
                        </button>
                        <button class="action-btn danger" onclick="cancelSubscription('${sub.userId}')">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                if (this.getAttribute('data-section')) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showSection(section);
                }
            });
        });

        function showSection(sectionId) {
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');

            // Show content section
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');

            // Refresh data when switching sections
            if (sectionId === 'overview') {
                loadDashboardData();
            } else if (sectionId === 'users') {
                loadUsersTable();
            } else if (sectionId === 'subscriptions') {
                loadSubscriptionsTable();
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // User management functions
        function viewUser(userId) {
            const userData = ecoTrackerDB.exportUserData(userId);
            const popup = window.open('', '_blank', 'width=600,height=400');
            popup.document.write(`
                <html>
                <head><title>User Details</title></head>
                <body style="font-family: Arial, sans-serif; padding: 20px;">
                    <h2>User Details</h2>
                    <pre style="background: #f5f5f5; padding: 15px; border-radius: 8px; overflow: auto;">
${JSON.stringify(userData, null, 2)}
                    </pre>
                </body>
                </html>
            `);
        }

        function editUser(userId) {
            const user = ecoTrackerDB.getUser(userId);
            const newName = prompt('Enter new name:', user.name);
            if (newName && newName !== user.name) {
                ecoTrackerDB.updateUser(userId, { name: newName });
                loadUsersTable();
                loadDashboardData();
                alert('User updated successfully!');
            }
        }

        function deleteUser(userId) {
            const user = ecoTrackerDB.getUser(userId);
            if (confirm(`Are you sure you want to delete user "${user.name || user.email}"? This action cannot be undone.`)) {
                ecoTrackerDB.deleteUser(userId);
                loadUsersTable();
                loadDashboardData();
                alert('User deleted successfully!');
            }
        }

        function changePlan(userId) {
            const newPlan = prompt('Enter new plan (trial, basic, pro, premium):');
            if (newPlan && ['trial', 'basic', 'pro', 'premium'].includes(newPlan)) {
                ecoTrackerDB.updateSubscription(userId, newPlan);
                loadSubscriptionsTable();
                loadDashboardData();
                alert('Subscription updated successfully!');
            } else if (newPlan) {
                alert('Invalid plan. Please use: trial, basic, pro, or premium');
            }
        }

        function cancelSubscription(userId) {
            if (confirm('Are you sure you want to cancel this subscription?')) {
                ecoTrackerDB.updateSubscription(userId, 'trial');
                loadSubscriptionsTable();
                loadDashboardData();
                alert('Subscription cancelled successfully!');
            }
        }

        // System management functions
        function exportAllData() {
            const allData = {
                users: ecoTrackerDB.getUsers(),
                subscriptions: ecoTrackerDB.getSubscriptions(),
                usageStats: ecoTrackerDB.getUsageStats(),
                appData: ecoTrackerDB.getAppData(),
                analytics: ecoTrackerDB.getAnalytics(),
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'eco-tracker-admin-export.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function resetDatabase() {
            if (confirm('Are you sure you want to reset the entire database? This will delete ALL user data and cannot be undone!')) {
                if (confirm('This action is irreversible. Please confirm again to proceed.')) {
                    ecoTrackerDB.resetDatabase();
                    loadDashboardData();
                    loadUsersTable();
                    loadSubscriptionsTable();
                    alert('Database reset successfully!');
                }
            }
        }

        function updateStorageInfo() {
            let totalSize = 0;
            for (let key in localStorage) {
                if (key.startsWith('ecoTracker_')) {
                    totalSize += localStorage[key].length;
                }
            }
            document.getElementById('storageUsed').textContent = (totalSize / 1024).toFixed(2) + ' KB';
        }

        // Search and filter functionality
        document.getElementById('userSearch')?.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('#usersTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.querySelector('.menu-toggle');
            
            if (window.innerWidth <= 1024 && 
                !sidebar.contains(event.target) && 
                !menuToggle.contains(event.target) && 
                sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
            }
        });
    </script>
</body>
</html>